#!/usr/bin/env python3
"""
Teste r√°pido do Santander Payments - Execute ap√≥s reiniciar Flask.
"""
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

print("=" * 60)
print("üß™ TESTE R√ÅPIDO: Santander Payments")
print("=" * 60)

# Importar servi√ßo
try:
    from services.santander_payments_service import SantanderPaymentsService
    print("‚úÖ M√≥dulos importados")
except Exception as e:
    print(f"‚ùå Erro ao importar: {e}")
    sys.exit(1)

# Inicializar servi√ßo
try:
    service = SantanderPaymentsService()
    print(f"‚úÖ Servi√ßo inicializado")
    print(f"   Habilitado: {service.enabled}")
    
    if not service.enabled:
        print("‚ùå Servi√ßo n√£o est√° habilitado")
        sys.exit(1)
    
    # Verificar configura√ß√£o
    if service.api:
        config = service.api.config
        print(f"   Base URL: {config.base_url}")
        print(f"   Client ID: {config.client_id[:20] + '...' if config.client_id else 'N√ÉO CONFIGURADO'}")
        print(f"   Client Secret: {'‚úÖ Configurado' if config.client_secret else '‚ùå N√ÉO CONFIGURADO'}")
        
        if "sandbox" in config.base_url.lower():
            print("   ‚úÖ Ambiente: SANDBOX")
        else:
            print("   ‚ö†Ô∏è Ambiente: PRODU√á√ÉO (n√£o √© sandbox!)")
        
        # Verificar certificados
        if config.cert_file:
            print(f"   Certificado: {config.cert_file}")
            if os.path.exists(config.cert_file):
                print("      ‚úÖ Arquivo existe")
            else:
                print("      ‚ùå Arquivo n√£o encontrado")
        else:
            print("   ‚ö†Ô∏è Certificado n√£o configurado (verificar fallback)")
        
        if config.key_file:
            print(f"   Chave: {config.key_file}")
            if os.path.exists(config.key_file):
                print("      ‚úÖ Arquivo existe")
            else:
                print("      ‚ùå Arquivo n√£o encontrado")
        else:
            print("   ‚ö†Ô∏è Chave n√£o configurada (verificar fallback)")
    
    # Testar conex√£o
    print("\nüì° Testando conex√£o com API...")
    resultado = service.listar_workspaces()
    
    if resultado.get('sucesso'):
        print("‚úÖ CONEX√ÉO BEM-SUCEDIDA!")
        resposta = resultado.get('resposta', '')
        print(f"\nResposta:\n{resposta[:500]}")
    else:
        print(f"‚ùå Erro na conex√£o:")
        print(f"   {resultado.get('erro', 'Erro desconhecido')}")
        print(f"   {resultado.get('resposta', '')[:300]}")
        
except Exception as e:
    print(f"‚ùå Erro: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)

print("\n" + "=" * 60)
print("‚úÖ TESTE CONCLU√çDO!")
print("=" * 60)
